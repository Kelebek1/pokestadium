#include "fragment62.h"
#include "6A40.h"
#include "12D80.h"
#include "30640.h"
#include "32D10.h"

static unk_D_843C49C0 D_843C49C0[2];

static Vtx D_84389D60[] = {
    VTX(-10, -10, 0, 0, 0, 0x88, 0x00, 0x00, 0x80),
    VTX(-10, 10, 0, 1984, 0, 0x88, 0x00, 0x00, 0x80),
    VTX(10, -10, 0, 0, 1984, 0x88, 0x00, 0x00, 0x80),
    VTX(10, 10, 0, 1984, 1984, 0x88, 0x00, 0x00, 0x80),
};
static Gfx D_84389DA0[] = {
    gsSPEndDisplayList(),
};
static u32 D_84389DA8[] = {
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x000B0019, 0x000B0000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x000F0620, 0x000F0000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00130F28, 0x00130000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00191A32, 0x00190000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0620253C,
    0x06200000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0F28374C, 0x0F280000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00070007, 0x00030000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1A324A5D, 0x1A320000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00030007, 0x00070007, 0x00070013, 0x0013000F, 0x00070000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x233A6273, 0x233A0000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0007000F,
    0x00130013, 0x00070000, 0x00000007, 0x00130620, 0x011C0017, 0x000B0000, 0x00000000, 0x00000000, 0x00000000,
    0x2F458390, 0x2F450000, 0x00000000, 0x00000000, 0x00000000, 0x000B0017, 0x011C0620, 0x00170007, 0x00000000,
    0x00000000, 0x00070017, 0x0C261A32, 0x142D0620, 0x000F0000, 0x00000000, 0x0003000F, 0x3C51A9B2, 0x3C51000F,
    0x00030000, 0x00000000, 0x000F0620, 0x142D1A32, 0x0C260017, 0x00070000, 0x00000000, 0x00000000, 0x00000003,
    0x00170F28, 0x2D433248, 0x253C0C26, 0x0000000B, 0x011C142D, 0x4F62E2E5, 0x4F62142D, 0x011C000B, 0x00000F28,
    0x253C3248, 0x2D430F28, 0x00170003, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x0000000F, 0x0C262F45,
    0x5E6F586A, 0x3C510822, 0x233A4357, 0x818EFFFF, 0x818E4357, 0x233A0822, 0x3C51586A, 0x60713248, 0x0F28000F,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00030620, 0x2F456979, 0xA6AF8C98,
    0x6273B0B8, 0xFFFFFFFF, 0xFFFFB0B8, 0x62738E9A, 0xA8B16979, 0x2F450620, 0x00030000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00071D35, 0x6979E5E8, 0xFFFFFFFF, 0xFFFFFFFF,
    0xFFFFFFFF, 0xFFFFE8EA, 0x69791D35, 0x00070000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000017, 0x20386C7C, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFF6C7C,
    0x20380017, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000017, 0x233A707F, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFF707F, 0x233A0017, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000017,
    0x20386C7C, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFFFFF, 0xFFFF6C7C, 0x20380017, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00071D35, 0x6777E5E8, 0xFFFFFFFF,
    0xFFFFFFFF, 0xFFFFFFFF, 0xFFFFE8EA, 0x69791D35, 0x00070000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00030620, 0x2F456979, 0xA6AF8E9A, 0x6273B0B8, 0xFFFFFFFF, 0xFFFFB0B8,
    0x62738E9A, 0xA8B16979, 0x2F450620, 0x00030000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x0000000F, 0x0C262F45, 0x5E6F586A, 0x3C510822, 0x233A4357, 0x818EFFFF, 0x818E4357, 0x233A0822, 0x3C51586A,
    0x5E6F3248, 0x0F28000F, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000003, 0x00170F28, 0x2D433248,
    0x253C0F28, 0x0000000B, 0x011C142D, 0x4F62E0E3, 0x4F62142D, 0x011C000B, 0x00000C26, 0x253C3248, 0x2D430F28,
    0x00170003, 0x00000000, 0x00000000, 0x00000000, 0x00070017, 0x0C261A32, 0x142D0620, 0x000F0000, 0x00000000,
    0x0003000F, 0x3C51A8B1, 0x3C51000F, 0x00030000, 0x00000000, 0x000F0620, 0x142D1A32, 0x0C260017, 0x00070000,
    0x00000000, 0x00000007, 0x00130620, 0x011C0017, 0x000B0000, 0x00000000, 0x00000000, 0x00000000, 0x2F45818E,
    0x2F450000, 0x00000000, 0x00000000, 0x00000000, 0x000B0017, 0x011C0620, 0x00130007, 0x00000000, 0x00070013,
    0x0013000F, 0x00070000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x233A6273, 0x233A0000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x0007000F, 0x00130013, 0x00070000, 0x00070007, 0x00030000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x1730485B, 0x17300000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00030007, 0x00070007, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x0C26354A, 0x0C260000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x0620253C, 0x06200000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00191A32, 0x00190000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00130F28, 0x00130000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x000F0620, 0x000F0000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x000B0019, 0x000B0000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00030013,
    0x00030000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
};
static Gfx D_8438A5A8[] = {
    gsDPPipeSync(),
    gsDPSetCycleType(G_CYC_1CYCLE),
    gsSPClearGeometryMode(G_ZBUFFER | G_SHADE | G_CULL_BOTH | G_FOG | G_LIGHTING | G_TEXTURE_GEN |
                          G_TEXTURE_GEN_LINEAR | G_LOD | G_SHADING_SMOOTH | G_CLIPPING | 0x0040F9FA),
    gsSPSetGeometryMode(G_ZBUFFER | G_SHADE | G_LIGHTING | G_SHADING_SMOOTH),
    gsSPTexture(0x8000, 0x8000, 0, G_TX_RENDERTILE, G_ON),
    gsDPPipeSync(),
    gsDPLoadTextureBlock(D_84389DA8, G_IM_FMT_IA, G_IM_SIZ_16b, 32, 32, 0, G_TX_NOMIRROR | G_TX_WRAP,
                         G_TX_NOMIRROR | G_TX_WRAP, 5, 5, G_TX_NOLOD, G_TX_NOLOD),
    gsDPSetCombineLERP(PRIMITIVE, ENVIRONMENT, TEXEL0, ENVIRONMENT, TEXEL0, 0, PRIMITIVE, 0, PRIMITIVE, ENVIRONMENT,
                       TEXEL0, ENVIRONMENT, TEXEL0, 0, PRIMITIVE, 0),
    gsDPSetEnvColor(0, 64, 255, 0),
    gsDPSetRenderMode(G_RM_ZB_XLU_SURF, G_RM_ZB_XLU_SURF2),
    gsSPVertex(D_84389D60, 4, 0),
    gsSP2Triangles(0, 1, 2, 0, 2, 1, 3, 0),
    gsSPEndDisplayList(),
};

Gfx D_8438A640[] = {
    gsSPEndDisplayList(),
};

u32 D_8438A648[] = {
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00001112, 0x22111000, 0x00000000, 0x00000000,
    0x00123344, 0x44433210, 0x00000000, 0x00000000, 0x12345566, 0x66655432, 0x10000000, 0x00000001, 0x34566777,
    0x88776654, 0x31000000, 0x00000013, 0x45678899, 0x99988765, 0x43100000, 0x00000134, 0x67899AAA, 0xAAAA9987,
    0x64310000, 0x00001346, 0x789ABBBC, 0xCCBBBA98, 0x76431000, 0x00002457, 0x89ABCCDD, 0xDDDCCBA9, 0x87542000,
    0x00013568, 0x9ABCDDEE, 0xEEEDDCBA, 0x98653100, 0x00024679, 0xABCDEFFF, 0xFFFFEDCB, 0xA9764200, 0x00035689,
    0xBCDEFFFF, 0xFFFFFEDC, 0xA9865300, 0x0013578A, 0xBCDFFFFF, 0xFFFFFFDC, 0xBA875310, 0x0014679A, 0xBDEFFFFF,
    0xFFFFFFED, 0xBA976410, 0x0024679A, 0xCDEFFFFF, 0xFFFFFFED, 0xCA986420, 0x0024689A, 0xCDEFFFFF, 0xFFFFFFED,
    0xCA986420, 0x0024689A, 0xCDEFFFFF, 0xFFFFFFED, 0xCA976420, 0x0014679A, 0xBDEFFFFF, 0xFFFFFFED, 0xBA976410,
    0x0013578A, 0xBCDFFFFF, 0xFFFFFFDC, 0xBA875310, 0x00035689, 0xBCDEFFFF, 0xFFFFFEDC, 0xB9865300, 0x00024679,
    0xABCDEFFF, 0xFFFFEDCB, 0xA9764200, 0x00013568, 0x9ABCDDEE, 0xEEEDDCBA, 0x98653100, 0x00002457, 0x89ABCCDD,
    0xDDDCCBA9, 0x87542000, 0x00001346, 0x789ABBBC, 0xCCBBBA98, 0x76431000, 0x00000134, 0x67899AAA, 0xAAAA9987,
    0x64310000, 0x00000013, 0x45678899, 0x99988765, 0x43100000, 0x00000001, 0x34566778, 0x87776654, 0x31000000,
    0x00000000, 0x12345566, 0x66655432, 0x10000000, 0x00000000, 0x00123344, 0x44433210, 0x00000000, 0x00000000,
    0x00001112, 0x22111000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000,
};

void func_8436E920(void) {
    s32 i;

    for (i = 0; i < 2; i++) {
        D_843C49C0[i].unk_000 = 0;
    }
}

s16 func_8436E944(void) {
    unk_D_843C49C0* var_a0;
    unk_D_843C49C0_004* var_v1;
    s32 i;
    s32 j;

    for (i = 0, var_a0 = &D_843C49C0[0]; i < 2; i++, var_a0++) {
        if (var_a0->unk_000 == 0) {
            var_v1 = &var_a0->unk_004[0];
            for (j = 0; j < 20; j++, var_v1++) {
                var_v1->unk_00 = 0;
                var_v1->unk_04 = 0;
                var_v1->unk_08 = 1.0f;
                var_v1->unk_0C.x = 0.0f;
                var_v1->unk_0C.y = 0.0f;
                var_v1->unk_0C.z = 0.0f;
            }
            var_a0->unk_000 = 1;
            return i;
        }
    }
    return -1;
}

void func_8436EA0C(s16 arg0, f32 arg1, f32 arg2, f32 arg3, s16 arg4, f32 arg5) {
    s32 i;
    unk_D_843C49C0* temp_v0 = &D_843C49C0[arg0];
    unk_D_843C49C0_004* var_v1;

    if (temp_v0->unk_000 != 0) {
        var_v1 = &temp_v0->unk_004[0];
        for (i = 0; i < 20; i++, var_v1++) {
            if (var_v1->unk_00 == 0) {
                var_v1->unk_00 = 1;
                var_v1->unk_04 = 0;
                var_v1->unk_06 = arg4;
                var_v1->unk_08 = arg5;
                var_v1->unk_0C.x = arg1;
                var_v1->unk_0C.y = arg2;
                var_v1->unk_0C.z = arg3;
                return;
            }
        }
    }
}

void func_8436EB54(s16 arg0) {
    unk_D_843C49C0* temp_v0 = &D_843C49C0[arg0];
    unk_D_843C49C0_004* var_v1;
    s32 i;

    if (temp_v0->unk_000 != 0) {
        var_v1 = &temp_v0->unk_004[0];
        for (i = 0; i < 20; i++, var_v1++) {
            if (var_v1->unk_00 == 1) {
                var_v1->unk_04++;
                if (var_v1->unk_06 < var_v1->unk_04) {
                    var_v1->unk_00 = 0;
                }
                var_v1->unk_0C.y -= 0.75f;
            }
        }
    }
}

Gfx* func_8436ECB0(Gfx* arg0, unk_D_843C49C0_004* arg1, MtxF* arg2) {
    f32 spCC;
    f32 spC8;
    f32 spC4;
    f32 spC0;
    Mtx* spBC;
    Mtx sp78;
    Mtx sp38;

    spCC = arg1->unk_0C.x;
    spC8 = arg1->unk_0C.y;
    spC4 = arg1->unk_0C.z;
    spC0 = arg1->unk_08;
    spC0 *= __sinf((arg1->unk_04 * 3.1415927f) / 10.0f);

    guScale(&sp38, spC0, spC0, spC0);
    guTranslate(&sp78, spCC, spC8, spC4);
    spBC = func_80005F5C(sizeof(Mtx) * 1);
    guMtxCatL(&sp38, &sp78, spBC);
    guMtxCatL(arg2, spBC, spBC);

    gSPMatrix(arg0++, spBC, G_MTX_PUSH | G_MTX_LOAD | G_MTX_MODELVIEW);
    gDPSetPrimColor(arg0++, 0, 0, 255, 255, 255, 200);
    gSPDisplayList(arg0++, D_8438A5A8);
    gSPPopMatrix(arg0++, G_MTX_MODELVIEW);

    return arg0;
}

Gfx* func_8436EDE8(s16 arg0, Gfx* arg1) {
    UNUSED s32 pad;
    unk_D_843C49C0* temp_s3 = &D_843C49C0[arg0];
    unk_D_843C49C0_004* var_s0;
    s32 i;
    MtxF sp78;
    MtxF sp38;

    if (temp_s3->unk_000 == 0) {
        return arg1;
    }

    func_80031EF4(sp78.mf, &D_8006F088->unk_60.mtxf);
    guMtxF2L(sp78.mf, sp38.mf);

    var_s0 = &temp_s3->unk_004;
    for (i = 0; i < 20; i++, var_s0++) {
        if (var_s0->unk_00 == 1) {
            arg1 = func_8436ECB0(arg1, var_s0, &sp38);
        }
    }

    return arg1;
}

void func_8436EED4(void) {
}

void func_8436EEDC(void) {
}

s32 func_8436EEE4(s32 arg0) {
    return arg0;
}
